---
title: "Updated Data"
author: "Marie Bouffard"
date: '2022-04-12'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

# Attach packages
library(tidyverse)
library(janitor)
library(here)
library(scales)

#---------------------------------------
# Read in Data
#---------------------------------------

# Task 1 
#---------------------------------------

# 1a 
# Read in 2018 state data
state_forest <- read.csv(here("Data", "New", "1a_State.csv")) %>% 
  clean_names()

# Read in 2018 county data
county_forest <- read.csv(here("Data", "New", "1a_County.csv")) %>% 
  clean_names()

#---------------------------------------
# Color  Palettes
#---------------------------------------

lu_palette <- c(
  "#6eb663", # Forest Canopy, light green
  "#8DBE87", # Low veg, light green
  "#F08701", # Impervious, orange 
  "#21A0A0",  # Wetland, Blue-green
  "#F9A620", # Roads, light orange
  "#D9682A", # Buildings/Structures, brick
  "#4059AD", # Water, royal blue
  "#F9DB6D", # Barren, light yellow
  "#57AF94" # Shrub, green-blue
)

```

### Task 1a. 2018 forest stats

```{r}
#---------------------------------------
# State level land use
#---------------------------------------

# Get percents 
state_lu_percent <- state_forest %>% 
  select(can_a_acres:apg_a_acres, total_a_acres) %>% 
  pivot_longer(can_a_acres:apg_a_acres, names_to = "lu", values_to = "acres") %>% 
  mutate(lu = case_when(
    lu == "can_a_acres" ~ "Tree Canopy",
    lu == "low_veg_a_acres" ~ "Low Vegetation",
    lu == "shrub_a_acres" ~ "Shrub",
    lu == "barren_a_acres" ~ "Barren",
    lu == "water_a_acres" ~ "Water",
    lu == "struc_a_acres" ~ "Structures",
    lu == "road_a_acres" ~ "Road",
    lu == "imperv_a_acres" ~ "Impervious",
    lu == "apg_a_acres" ~ "Aberdeen Proving Ground")) %>% 
    # lu == "total_a_acres" ~ "Total Area",
    # lu == "land_a_acres" ~ "Land_Area"))
  mutate(percent = acres/total_a_acres,
         label = scales::percent(percent)) %>% 
  mutate(lu = fct_reorder(lu, desc(percent))) %>% 
  select(lu:label)

state_lu_percent$name <- "Statewide"

#---------------------------------------
# County level land use
#---------------------------------------

# Get percents 
county_lu_percent <- county_forest %>% 
  select(name, can_a_acres:apg_a_acres) %>% 
  pivot_longer(can_a_acres:apg_a_acres, names_to = "lu", values_to = "acres") %>% 
    mutate(lu = case_when(
    lu == "can_a_acres" ~ "Tree Canopy",
    lu == "low_veg_a_acres" ~ "Low Vegetation",
    lu == "shrub_a_acres" ~ "Shrub",
    lu == "barren_a_acres" ~ "Barren",
    lu == "water_a_acres" ~ "Water",
    lu == "struc_a_acres" ~ "Structures",
    lu == "road_a_acres" ~ "Road",
    lu == "imperv_a_acres" ~ "Impervious",
    lu == "apg_a_acres" ~ "Aberdeen Proving Ground")) %>% 
  group_by(name) %>% 
  mutate(percent = acres/sum(acres),
         label = scales::percent(percent))

#---------------------------------------
# Stacked bar plor lu percent area state and county
#---------------------------------------

# Merge state and county dfs
state_county_merge <- rbind(state_lu_percent, county_lu_percent) %>% 
  mutate(name = as.factor(name)) %>%  
  mutate(name= fct_relevel(name, "Statewide", " ")) %>% 
  select(name, everything())

# Plot
#---------------------------------------
ggplot(data = state_county_merge, aes(x = fct_rev(name), y = percent, fill = lu)) +
  geom_bar(position = "fill", stat = "identity") +
    labs(
    title = "2018 Land Use Proportions by Jurisdiction",
    x = "Jurisdiction",
    y = "Percent Cover") +
    scale_y_continuous(breaks = c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1),
                     labels = c("0%", "10%", "20%", "30%", "40%", "50%", "60%", "70%", "80%", "90%", "100%")) +
    theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    axis.title = element_text(size = 14, margin = margin(t = 10, r = 0, b = 0, l = 0)),
    legend.title = element_text(size = 14),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  )+
  guides(fill = guide_legend(title = "Land Use Type")) +
  coord_flip()

```

