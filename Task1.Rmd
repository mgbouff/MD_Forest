---
title: "Task 1: Plantable Area"
author: "Marie Bouffard"
date: "11/19/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r}
# Attach packages
library(tidyverse)
library(janitor)
library(here)
library(scales)

#1a.
# Read in 2018 state data
state_forest <- read.csv(here("Data", "1a_state_short_2018.csv")) %>% 
  clean_names()

# Read in 2018 county data
county_forest <- read.csv(here("Data", "1a_County_short_2018.csv")) %>% 
  clean_names()

# 1b.
# Read in Plantable Area data
plantable_county <- read.csv(here("Data", "1b_plantable_2018_county.csv")) %>% 
  clean_names() %>% 
  rename(county = i_county) %>% 
  mutate(county = as.factor(county))

lc_pallette <- c("#6eb663", # Forest Canopy, light green
                 "#8DBE87", # Low veg, light green
                 "#F08701", # Impervious, orange 
                 "#21A0A0",  # Wetland, Blue-green
                 "#F9A620", # Roads, light orange
                 "#D9682A", # Buildings, brick
#                 "#24693d", # Forest, green
                 "#4059AD", # Water, royal blue
                 "#F9DB6D", # Barren, light yellow
                 "#57AF94" # Shrub, green-blue
                 )

lc_county_pallette <- c(
  "#6eb663", # Forest Canopy, light green
  "#8DBE87", # Low veg, light green
  "#F08701", # Impervious, orange 
  "#21A0A0",  # Wetland, Blue-green
  "#F9A620", # Roads, light orange
  "#D9682A", # Buildings, brick
  "#4059AD", # Water, royal blue
  "#F9DB6D", # Barren, light yellow
  "#57AF94" # Shrub, green-blue
)


```

### Task 1a. 2018 forest stats

#### State Level
Tree canopy inside vs. outside forests
```{r}
#---------------------------------------
# 2018 statewide tree canopy inside vs. outside forest
#---------------------------------------
state_in_out <- state_forest %>% 
  select(tc_a_acres_inside_forest, tc_a_acres_outside_forest) %>% 
  pivot_longer(tc_a_acres_inside_forest:tc_a_acres_outside_forest,
               names_to = "type",
               values_to = "acres") %>% 
  mutate(type = case_when(
    type == "tc_a_acres_inside_forest" ~ "Inside Forest",
    type == "tc_a_acres_outside_forest" ~ "Outside Forest"))

# Plot
state_in_out_plot <- ggplot(data = state_in_out, aes(x = type, y = acres)) +
  geom_col(aes(fill = type)) +
  scale_fill_manual(values = c("#24693d", "#6eb663")) +
  labs(title = "2018 Tree Canopy Inside and Outside Forests",
       y = "Tree Canopy Area (Acres)") +
  scale_y_continuous(breaks = c(0, 500000, 1000000, 1500000),
                     labels = c("0", "500,000", "1,000,000", "1,500,000")) +
  theme_minimal() +
  theme(
    text = element_text(family = "Times", size = 12),
    plot.title = element_text(size = 16, face = "bold"),
    axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0), size = 14, face = "bold"),
    axis.title.x = element_blank(),
    axis.text.x = element_text(size = 14, face = "bold"),
    legend.position = "none"
  )

state_in_out_plot

ggsave(here("Graphics", "1a_state_in_out_forest_2018.jpg"), state_in_out_plot)

```
Other land use change
```{r}
#---------------------------------------
# 2018 statewide land cover change
#---------------------------------------

# Get percents 
state_lc_percent <- state_forest %>% 
  select(i_total_a_acres:imperv_a_acres) %>% 
  pivot_longer(can_a_acres:imperv_a_acres, names_to = "lc", values_to = "acres") %>%
  mutate(lc = case_when(
#    lc == "i_total_a_acres" ~ "Total Acres",
    lc == "can_a_acres" ~ "Tree Canopy",
    lc == "low_veg_a_acres" ~ "Low Vegetation",
    lc == "barren_a_acres" ~ "Barren",
    lc == "water_a_acres" ~ "Water",
    lc == "build_a_acres" ~ "Building",
    lc == "road_a_acres" ~ "Road",
    lc == "imperv_a_acres" ~ "Impervious",
    lc == "wetlands_a_acres" ~ "Wetlands",
    lc == "shrub_a_acres" ~ "Shrub")) %>% 
  mutate(percent = acres/sum(acres),
         label = scales::percent(percent)) %>% 
  mutate(lc = fct_reorder(lc, desc(percent)))

state_lc_percent$state <- "Maryland"

# plot columns
#---------------------------------------
state_lc_percent_col <- ggplot(data = state_lc_percent, aes(x = lc, y = percent, label = label)) +
  geom_col(aes(fill = lc)) +
  geom_text(hjust = -0.1, color = "grey40", size = 3) +
  scale_y_continuous(breaks = c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.65),
                     labels = c("0%", "10%", "20%", "30%", "40%", "50%", " ")) +
  scale_fill_manual(values = lc_pallette) +
  labs(x = "Land Use Type",
       y = "Percent of Land Cover") +
  coord_flip() +
  theme_minimal() +
  theme(
    text = element_text(family = "Times", size = 12),
    plot.title = element_text(size = 16, face = "bold"),
    axis.title = element_text(size = 14, face = "bold"),
#    axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
    axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)),
    legend.position = "none"
  )

state_lc_percent_col

# ggsave(here("Graphics", "1a_state_lc_col.jpg"), state_lc_percent_col, width = 7.5, height = 4.5)

# plot stacked bar
#---------------------------------------
state_lc_percent_stack <- ggplot(data = state_lc_percent, aes(fill = lc, x = state, y = percent, label = label)) +
  geom_bar(position = "fill", stat = "identity") +
  geom_text(
#    vjust = -12, 
    hjust = -5, 
    size = 3,
    color = "white") +
  labs(
    title = "2018 Land Cover Proportions",
    y = "Percent State Land Cover") +
  scale_y_continuous(breaks = c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1),
                     labels = c("0%", "10%", "20%", "30%", "40%", "50%", "60%", "70%", "80%", "90%", "100%")) +
  scale_fill_manual(values = lc_pallette) +
  coord_flip() +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.title.x = element_text(size = 14, margin = margin(t = 10, r = 0, b = 0, l = 0)),
    legend.title = element_text(size = 14),
    legend.position = "top",
    legend.title.align = 0.5
  ) +
  guides(fill = guide_legend(title = "Land Cover Type",
                             title.position = "top"))

state_lc_percent_stack

ggsave(here("Graphics", "1a_state_lc_stack.jpg"), state_lc_percent_stack, width = 7.29, height = 3)

```
#### County Level
Tree canopy inside vs. outside forests
```{r}
#---------------------------------------
# 2018 tree canopy inside vs. outside forest by county
#---------------------------------------

county_in_out <- county_forest %>% 
  select(county, tc_a_acres_inside_forest, tc_a_acres_outside_forest) %>% 
  pivot_longer(!county, names_to = "type", values_to = "acres") %>% 
      mutate(type = case_when(
    type == "tc_a_acres_inside_forest" ~ "Inside Forest",
    type == "tc_a_acres_outside_forest" ~ "Outside Forest")) %>% 
  mutate(county = as.factor(county))

# Plot
county_in_out_plot <- ggplot(data = county_in_out, aes(x = fct_rev(county), y = acres))+
  geom_col(aes(fill = type), position = "dodge") +
  scale_fill_manual(values = c("#24693d", "#6eb663")) +
  scale_y_continuous(breaks = c(0, 50000, 100000, 150000),
                     labels = c("0", "50,000", "100,000", "150,000")) +
  labs(title = "2018 Tree Canopy Inside and Outside Forests",
       x = "County",
       y = "Tree Canopy Area (Acres)") +
  coord_flip() +
  theme_minimal() +
  theme(
    text = element_text(family = "Times", size = 12),
    plot.title = element_text(size = 16, face = "bold"),
    axis.title = element_text(size = 14, face = "bold"),
    axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
    axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)),
    legend.title = element_blank()
  )

county_in_out_plot

# ggsave(here("Graphics", "1a_county_in_out_forest_2018.jpg"), county_in_out_plot)

```
Other land use change by county
```{r}
#---------------------------------------
# 2018 statewide land cover change by county
#---------------------------------------

county_lc_2018 <- county_forest %>% 
  select(county, can_p:shrub_p) %>% 
  pivot_longer(!county, names_to = "type", values_to = "percent") %>% 
    mutate(type = case_when(
    type == "can_p" ~ "Tree Canopy",
    type == "low_veg_p" ~ "Low Vegetation",
    type == "barren_p" ~ "Barren",
    type == "water_p" ~ "Water",
    type == "build_p" ~ "Building",
    type == "road_p" ~ "Road",
    type == "imperv_p" ~ "Impervious",
    type == "wetlands_p" ~ "Wetlands",
    type == "shrub_p" ~ "Shrub")) %>% 
  mutate(county = as.factor(county)) %>% 
  mutate(type = fct_reorder(type, desc(percent)))

county_lc_percent_stack <- ggplot(data = county_lc_2018, aes(fill = type, x = fct_rev(county), y = percent)) +
  geom_bar(position = "fill", stat = "identity") +
  labs(
    title = "2018 Land Cover Proportions by County",
    x = "County",
    y = "Percent Land Cover") +
  scale_y_continuous(breaks = c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1),
                     labels = c("0%", "10%", "20%", "30%", "40%", "50%", "60%", "70%", "80%", "90%", "100%")) +
  scale_fill_manual(values = lc_county_pallette) +
  coord_flip() +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    axis.title = element_text(size = 14, margin = margin(t = 10, r = 0, b = 0, l = 0)),
    legend.title = element_text(size = 14)
  )+
  guides(fill = guide_legend(title = "Land Cover Type"))

county_lc_percent_stack

ggsave(here("Graphics", "1a_county_lc_stack.jpg"), county_lc_percent_stack)

```
Attempt merge state row into county plot
```{r}

# Merge Dataframes
state_merge <- state_lc_percent %>% 
  mutate(type = lc) %>% 
  select(type, percent) %>% 
  mutate(percent = percent*100)
  
state_merge$county <- c("Statewide")

state_merge <- state_merge[,c("county", "type", "percent")]

state_county_merge <- rbind(state_merge, county_lc_2018) %>% 
  mutate(county = as.factor(county)) %>%  
  mutate(county = fct_relevel(county, "Statewide", " "))

# Make bold label for state
# bold.state <- "Statewide"
# bold.label <- ifelse(levels(state_county_merge$county) %in% bold.state, yes = "bold", no = "plain")
# Almost works

# Plot
county_state_merge_plot <- ggplot(data = state_county_merge, aes(fill = type, x = fct_rev(county), y = percent)) +
  geom_bar(position = "fill", stat = "identity") +
  labs(
    title = "2018 Land Cover Proportions by County",
    x = "County",
    y = "Percent Land Cover") +
  scale_y_continuous(breaks = c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1),
                     labels = c("0%", "10%", "20%", "30%", "40%", "50%", "60%", "70%", "80%", "90%", "100%")) +
  scale_fill_manual(values = lc_county_pallette) +
  coord_flip() +
  theme_minimal() +
  theme(
#    axis.text.y = element_text(face = bold.label),
    plot.title = element_text(size = 16, face = "bold"),
    axis.title = element_text(size = 14, margin = margin(t = 10, r = 0, b = 0, l = 0)),
    legend.title = element_text(size = 14),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  )+
  guides(fill = guide_legend(title = "Land Cover Type"))

county_state_merge_plot

ggsave(here("Graphics", "1a_county_state_lu_change.jpg"), county_state_merge_plot)

```


### Task 1b. Plantable Area
```{r}

#---------------------------------------
# Plantable Area by county
#---------------------------------------

plantable_county_plot <- ggplot(data = plantable_county, aes(x = fct_rev(county), y = area_acres)) +
  geom_col(fill = "seagreen4") +
  labs(x = "County", 
       y = "Acres",
       title = "Plantable Area by Jursidction") +
  scale_y_continuous(breaks = c(0, 25000, 50000, 75000),
                     labels = c("0", "25,000", "50,000", "75,000")) +
  coord_flip() +
  theme_minimal() +
  theme(
    text = element_text(family = "Times"),
    axis.text = element_text(size = 12),
    axis.title = element_text(size = 14, family = "Times", face = "bold"),
    plot.title = element_text(size = 16, family = "Times", face = "bold")
    )

plantable_county_plot

```

