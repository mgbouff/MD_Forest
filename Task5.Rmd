---
title: "Task 5: Tabulated Forest Cover/Change"
author: "Marie Bouffard"
date: "11/16/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r}
# Attach packages
library(tidyverse)
library(readxl)
library(janitor)
library(here)

# Read in State data
state_tab <- read_excel(here("Data", "tabulated_forest.xlsx"), sheet = "state")

# State land cover data
state_lc <- read.csv(here("Data", "5_state_physical_LCForest_2013_2018.csv")) %>% 
  clean_names()

# Read in County data
county_tab <- read_excel(here("Data","tabulated_forest.xlsx"), sheet = "county")

# Read in County Land Cover Data
county_lc <- read.csv(here("Data", "5_county_physical_LCForest_2013_2018.csv")) %>% 
  clean_names()
  
# Land Use Update
land_use_update <- read.csv(here("Data", "5_LandUse_update.csv")) %>% 
  clean_names() %>% 
  select(i_desclu, tc_change_acres:outside_forest_change_acres)

land_use_update[land_use_update == " "] <- NA

# PFA data
pfa_data <- read.csv(here("Data", "5_PFA.csv")) %>% 
  clean_names()

# Categorical County Color Pallette
county_pallette <- c("#68affc", "#485172", "#d6a7f0", "#7c46a0", "#20d8fd", "#155126", "#a2e84f", "#528f7a", "#7dd9a0", "#39970e", "#d0d9ae", "#e27040", "#f29180", "#e13224", "#922d4c", "#d9c937", "#fa217f", "#36f459", "#b825af", "#f27ff5", "#fda547", "#b7358d", "#a1e8af", "#7e52a0")

lu_pallette <- c("#F9DB6D", # Barren, light yellow
                 "#D9682A", # Buildings, brick
                 "#24693d", # Forest, green
                 "#F08701", # Impervious, orange 
                 "#8DBE87", # Low veg, light green
                 "#F9A620", # Roads, light orange
                 "#57AF94", # Shrub, green-blue
                 "#6eb663", # Outside Forest, light green
                 "#4059AD", # Water, royal blue
                 "#21A0A0") # Wetland, Blue-green

lu_tc_pallette <- c("#F08701", # Impervious, orange
                    "#D9682A", # Buildings, brick
                    "#F9DB6D", # Barren, light yellow 
                    "#4059AD", # Water, royal blue
                    "#F9A620", # Roads, light orange
                    "#21A0A0", # Wetland, Blue-green
                    "#57AF94", # Shrub, green-blue
                    "#8DBE87", # Low veg, light green
                    "#6eb663") # Tree Canopy, green)  

# County Pallet
county_pallette <- c("#68affc", "#485172", "#d6a7f0", "#7c46a0", "#20d8fd", "#155126", "#a2e84f", "#528f7a", "#7dd9a0", "#39970e", "#d0d9ae", "#e27040", "#f29180", "#e13224", "#922d4c", "#d9c937", "#fa217f", "#36f459", "#b825af", "#f27ff5", "#fda547", "#b7358d", "#a1e8af", "#7e52a0")

# Use stringr::str_wrap() to create breaks in long facet titles
stwr <- function(string, nwrap = 15){
  paste(strwrap(string, width = nwrap), collapse = "\n")
}

stwr = Vectorize(stwr)

```
### Forested Area at the State Level
```{r}
#---------------------------------------
# Maryland Statewide Tabulated Forest Cover
#---------------------------------------

# Wrangle state data (get rid of non-forested, convert to acres)
state_clean <- state_tab %>% 
  clean_names() %>% 
  filter(reclassified_value == "1") %>%
  select(year:area_m, -reclassified_value) %>% 
  mutate(acres = area_m*0.000247105)

# Plot totals over time
plot_totals_state <- ggplot(data = state_clean, aes(x = year, y = acres))+
  geom_line(color = "seagreen4", size = 2)+
    labs(
      title = "State Forested Area 2000 to 2020",
      x = "Year",
      y = "Forest Area (Acres)") +
    scale_y_continuous(breaks = c(3300000, 3325000, 3350000),
    labels = c("3,300,000","3,325,000","3,350,000"))+
  theme_minimal() +
  theme(text = element_text(size = 14, family = "Times"),
        axis.title = element_text(size = 14, face = "bold"),
        axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
        axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)))

ggsave(here("Graphics", "totals_state.jpg"),plot_totals_state)

plot_totals_state

```
Change between Time periods
```{r}
# State change between time periods
#---------------------------------------
state_change <- state_clean %>% 
  mutate(year_diff = acres - lead(acres))

# Plot difference between time periods
plot_change_state <- ggplot(data = state_change, aes(x = year, y = year_diff))+
  geom_col(fill = "seagreen4")+
  geom_text(aes(label = round(year_diff, digits = 1)),
            vjust = -0.5) +
  scale_x_continuous(breaks = c(2005, 2010, 2015, 2020),
    labels = c("2000-2005","2005-2010","2010-2015","2015-2020"))+
    scale_y_continuous(breaks = c(0, 10000, 20000),
    labels = c("0","10,000","20,000"))+
    labs(x = "Time Period",
       y = "Change in Total Area (Acres)") +
  scale_x_continuous(limits=c(2002,2023))+
  # scale_y_continuous(limits=c(-30000,1000))+
  geom_hline(aes(yintercept=0))+
  geom_vline(aes(xintercept=2002))+
  theme_minimal()+
  theme(text = element_text(size = 16, family = "Times"),
        axis.title = element_text(size = 14, face = "bold"),
        axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)),
        axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)))

plot_change_state

ggsave(here("Graphics", "change_state.jpg"),plot_change_state, width = 7, height = 4.4)

```
### Forested Area at the County Level
```{r}
#---------------------------------------
# Tabulated Forest Cover by county
#---------------------------------------

# Wrangle county data (convert to tidy format, convert to acres)
county_clean <- county_tab %>% 
  filter(Value == 1) %>%
  select("COUNTY":"2020", -Value) %>% 
  pivot_longer(!COUNTY, names_to = "year", values_to = "area_m") %>% 
  mutate(acres = area_m*0.000247105) %>% 
  mutate(year = as.numeric(year)) %>%
  clean_names()

# Plot totals over time by county
plot_totals_county_all <- ggplot(data = county_clean, aes(x = year, y = acres)) +
  geom_line(color = "seagreen4", size = 1) +
  scale_x_continuous(breaks = c(2000, 2005, 2010, 2015, 2020), 
                     labels = c("2000","", "2010","","2020")) +
  facet_wrap(~county, ncol = 4, scales = "free_y") +
      labs(x = "Year",
       y = "Forested Area (acres)") +
  theme_minimal() +
  theme(text = element_text(family = "Times", size = 10),
    axis.title = element_text(size = 16, family = "Times"),
    axis.text = element_text(size = 10, family = "Times"),
    panel.spacing.x = unit(2, "lines"),
    axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0), size = 14, face = "bold"),
    axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0), size = 14, face = "bold"))

ggsave(here("Graphics", "totals_county_all.jpg"),plot_totals_county_all, width=7, height=7)

plot_totals_county_all

# Plot totals over time by county with county pallette
plot_totals_county_cp <- ggplot(data = county_clean, aes(x = year, y = acres)) +
  geom_line(aes(color = county), size = 1) +
  scale_color_manual(values = county_pallette) +
  scale_x_continuous(breaks = c(2000, 2005, 2010, 2015, 2020), 
                     labels = c("2000","", "2010","","2020")) +
  facet_wrap(~county, ncol = 4, scales = "free_y") +
      labs(x = "Year",
       y = "Forested Area (acres)") +
  theme_minimal() +
  theme(text = element_text(family = "Times", size = 10),
    axis.title = element_text(size = 16, family = "Times"),
    axis.text = element_text(size = 10, family = "Times"),
    panel.spacing.x = unit(2, "lines"),
    legend.position = "none",
    axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0), size = 14, face = "bold"),
    axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0), size = 14, face = "bold"))

ggsave(here("Graphics", "totals_county_all_cp.jpg"),plot_totals_county_cp, width=7, height=7)

plot_totals_county_cp

```
Change by time periods faceted by county
```{r}
# County change between time periods
#---------------------------------------
county_change <- county_clean %>% 
  group_by(county) %>% 
  mutate(year_diff = acres - lag(acres))

# Plot difference between time periods
plot_change_county_all <- ggplot(data = county_change, aes(x = year, y = year_diff))+
  geom_col(fill = "seagreen4")+
  scale_x_continuous(breaks = c(2005, 2010, 2015, 2020),
    labels = c("2000-2005","2005-2010","2010-2015","2015-2020"))+
    labs(x = "Time Period",
       y = "Total Change in Area (Acres)") +
    geom_hline(aes(yintercept=0))+
    geom_vline(aes(xintercept=2002))+
  facet_wrap(~county, ncol = 4, scales = "free_y")+
  theme_minimal() +
  theme(
    text = element_text(family = "Times"),
    axis.title = element_text(size = 16, family = "Times"),
    axis.text = element_text(size = 10, family = "Times"),
    axis.text.x = element_text(angle = 90),
    panel.spacing = unit(1, "lines"),
    axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0), size = 14, face = "bold"),
    axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0), size = 14, face = "bold")
    )

# ggsave(here("Graphics", "change_county_all.jpg"),plot_change_county_all, width=7, height=7)

plot_change_county_all

# Plot difference between time periods with county pallette
plot_change_county_cp <- ggplot(data = county_change, aes(x = year, y = year_diff))+
  geom_col(aes(fill = county))+
  scale_fill_manual(values = county_pallette) +
  scale_x_continuous(breaks = c(2005, 2010, 2015, 2020),
    labels = c("2000-2005","2005-2010","2010-2015","2015-2020"))+
    labs(x = "Time Period",
       y = "Total Change in Area (Acres)") +
    geom_hline(aes(yintercept=0))+
    geom_vline(aes(xintercept=2002))+
  facet_wrap(~county, ncol = 4, scales = "free_y")+
  theme_minimal() +
  theme(
    text = element_text(family = "Times"),
    axis.title = element_text(size = 16, family = "Times"),
    axis.text = element_text(size = 10, family = "Times"),
    axis.text.x = element_text(angle = 90),
    panel.spacing = unit(1, "lines"),
    axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0), size = 14, face = "bold"),
    axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0), size = 14, face = "bold"),
    legend.position = "none"
    )

ggsave(here("Graphics", "change_county_cp.jpg"),plot_change_county_cp, width=7, height=7)

plot_change_county_cp

```

Change by time periods faceted by time period
```{r}
# Try faceting by time period instead of county
#---------------------------------------

# Wrangle for time period categories
county_change_period <- county_change %>%
  filter(year %in% c(2005,2010,2015,2020)) %>% 
  mutate(time_period = case_when(
    year == 2005 ~ "2000 - 2005",
    year == 2010 ~ "2005 - 2010",
    year == 2015 ~ "2010 - 2015",
    year == 2020 ~ "2015 - 2020"
  ))

#Trying to rename years to time periods
# period_names <- list(
#   "2005"="2000-2005",
#   "2010"="2005-2010",
#   "2015"="2010-2015",
#   "2020"="2015-2020")
# 
# period_labeller <- function(year,value){
#   return(period_names[value])
# }

# county_change_by_period <- ggplot(data = county_change_period, aes(x = county, y = year_diff))+
#   geom_col(aes(fill = county)) +
#   scale_fill_manual(values = county_pallette) +
#   facet_wrap(~time_period)+
#   labs(x = "County",
#        y = "Total Change in Acreage")+
#   theme_minimal()+
#   geom_hline(aes(yintercept=0))+
#   geom_vline(aes(xintercept=0))+
#   theme(
#     legend.position = "bottom",
#     legend.title = element_blank(),
#     axis.text.x = element_blank()
#   ) +
#   guides(fill = guide_legend(nrow = 4))
# 
# county_change_by_period
# 
# # ggsave(here("Graphics", "county_change_by_period.jpg"), county_change_by_period)

```

### Land Cover Area Change
State
```{r}
#---------------------------------------
# Land Cover Area Change State Level (acres)
#---------------------------------------
state_lc_acres <- state_lc %>% 
  select(tc_area_acres_change:impervious_area_acres_change) %>% 
  pivot_longer(tc_area_acres_change:impervious_area_acres_change, names_to = "lc", values_to = "acres") %>% 
    mutate(lc = case_when(
    lc == "low_veg_area_acres_change" ~ "Low Vegetation",
    lc == "barren_area_acres_change" ~ "Barren",
    lc == "water_area_acres_change" ~ "Water",
    lc == "buildings_area_acres_change" ~ "Buildings",
    lc == "road_area_acres_change" ~ "Roads",
    lc == "shrub_area_acres_change" ~ "Shrub",
    lc == "wetlands_area_acres_change" ~ "Wetland",
    lc == "impervious_area_acres_change" ~ "Impervious",
    lc == "tc_area_acres_change" ~ "Tree Canopy")) %>% 
  mutate(lc = fct_reorder(lc, desc(acres)))

# Plot
#---------------------------------------
state_lc_plot <- ggplot(data = state_lc_acres, aes(x = lc, y = acres)) +
  geom_col(aes(fill = lc)) +
  labs(title = "Land Cover Area Change",
       x = "Land Cover",
       y = "Area Change (Acres)") +
  scale_y_continuous(breaks = c(-10000, -5000, 0, 5000, 10000),
                     labels = c("-10,000", "-5,000", "0", "5,000", "10,000")) +
  scale_fill_manual(values = lu_tc_pallette) +
  geom_hline(aes(yintercept=0)) +
  coord_flip() +
  theme_minimal() +
  theme(
    legend.position = "none",
       axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0), size = 14, face = "bold"),
       axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0), size = 14, face = "bold"),
    plot.title = element_text(size = 16, face = "bold")
  )

state_lc_plot

ggsave(here("Graphics", "5_state_lc.jpg"), state_lc_plot)

```
### Tree Canopy Change
State Acres
```{r}
#---------------------------------------
# Tree Canopy Change in/out of Forest State Level (acres)
#---------------------------------------
state_tc <- state_lc %>% 
  select(tc_outside_forest_change_acres:tc_inside_forest_change_acres) %>% 
  pivot_longer(tc_outside_forest_change_acres:tc_inside_forest_change_acres, 
               names_to = "forest_type", 
               values_to = "acres") %>% 
    mutate(forest_type = case_when(
    forest_type == "tc_inside_forest_change_acres" ~ "Forest",
    forest_type == "tc_outside_forest_change_acres" ~ "Tree Canopy Outside Forest"))

# Plot
#---------------------------------------
state_tc_plot <- ggplot(data = state_tc, aes(x = forest_type, y = acres)) +
  geom_col(aes(fill = forest_type)) +
    scale_fill_manual(values = c("#24693d", # Inside
                               "#6eb663" # Outside
                               )) +
  geom_text(aes(label = round(acres, digits = 0),
                color = forest_type),
            vjust = 1.15) +
  scale_color_manual(values = c("#24693d", # Inside
                               "#6eb663" # Outside
                               )) +
  geom_hline(aes(yintercept=0)) +
  labs(title = "Tree Canopy Change Within and Outside Forests \n between 2013 and 2018",
       x = "Forest Type",
       y = "Area Change (Acres)") +
  scale_y_continuous(breaks = c(0, -2500, -5000, -7500, -10000, -12500),
                     labels = c("0", "-2,500","-5,000", "-7,500", "10,000", "-12,500")) +
  theme_minimal() +
  theme(
    legend.position = "none",
 axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0), size = 14, face = "bold"),
       axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0), size = 14, face = "bold"),
    plot.title = element_text(size = 16, face = "bold")
  )

state_tc_plot

ggsave(here("Graphics", "5_state_tc.jpg"), state_tc_plot, height = 5)

```
State Percent
```{r}
#---------------------------------------
# Tree Canopy Change in/out of Forest State Level (percent)
#---------------------------------------
state_tc_percent <- state_lc %>%
  select(inside_pchange:outside_pchange) %>%
  pivot_longer(inside_pchange:outside_pchange,
               names_to = "forest_type",
               values_to = "decimal") %>%
    mutate(forest_type = case_when(
    forest_type == "inside_pchange" ~ "Forest",
    forest_type == "outside_pchange" ~ "Tree Canopy Outside Forest")) %>% 
  mutate(percent = decimal*100)

# Plot
#---------------------------------------
state_tc_percent_plot <- ggplot(data = state_tc_percent, aes(x = forest_type, y = percent)) +
  geom_col(aes(fill = forest_type)) +
    scale_fill_manual(values = c("#24693d", # Inside
                               "#6eb663" # Outside
                               )) +
  # geom_text(aes(label = round(percent, digits = 0),
  #               color = forest_type),
  #          vjust = 1.15) +
  scale_color_manual(values = c("#24693d", # Inside
                               "#6eb663" # Outside
                               )) +
  annotate("text",
           x = 1, y = -73,
           label = "-71%", color = "#24693d") +
  annotate("text",
           x = 2, y = -7,
           label = "-5%", color = "#6eb663") +
 geom_hline(aes(yintercept=0)) +
  labs(title = "Tree Canopy Percent Change Within and Outside Forests \n between 2013 and 2018",
       x = "Forest Type",
       y = "Percent Area Change") +
  scale_y_continuous(breaks = c(0, -20, -40, -60),
                     labels = c("0", "-20%","-40%", "-60%")) +
  theme_minimal() +
  theme(
    legend.position = "none",
 axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0), size = 14, face = "bold"),
       axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0), size = 14, face = "bold"),
    plot.title = element_text(size = 16, face = "bold")
  )

ggsave(here("Graphics", "5_state_tc_percent.jpg"), state_tc_percent_plot, height = 5)

```

County
```{r}
#---------------------------------------
# Tree Canopy Change in/out of Forest County Level (acres)
#---------------------------------------
county_tc <- county_lc %>% 
  select(i_county, tc_outside_forest_change_acres, tc_inside_forest_change_acres) %>% 
  pivot_longer(!i_county, names_to = "forest_type", values_to = "acres") %>%
  mutate(forest_type = case_when(
    forest_type == "tc_inside_forest_change_acres" ~ "Forest",
    forest_type == "tc_outside_forest_change_acres" ~ "Tree Canopy Outside Forest"))

# Plot
#---------------------------------------
county_tc_change_plot <- ggplot(data = county_tc, aes(x = i_county, y = acres)) +
  geom_col(position = "dodge",
           aes(fill = forest_type)) +
  scale_fill_manual(values = c("#24693d", # Inside
                               "#6eb663" # Outside
                               )) +
  scale_y_continuous(breaks = c(-4000, -2000, 0, 2000),
                     labels = c("-4,000", "-2,000", "0", "2,000")) +
  labs(title = "Tree Canopy Change Within and Outside Forests",
       x = "Jurisdiction",
       y = "Area Change (Acres)") +
  coord_flip() +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    legend.title = element_blank(),
    legend.title.align = 0.5,
    axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0), size = 14, face = "bold"),
    axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0), size = 14, face = "bold"),
    plot.title = element_text(size = 16, face = "bold")
  ) +
  guides(fill = guide_legend(title = "Forest Type",
                            title.position = "top"))

county_tc_change_plot

ggsave(here("Graphics", "5_county_tc_change.jpg"), county_tc_change_plot)

```


### Land Use
Acres
```{r}
#---------------------------------------
# Land Use Change in Acres
#---------------------------------------
# Update
land_use_acres_update <- land_use_update %>% 
  pivot_longer(!i_desclu, names_to = "land_use", values_to = "acres") %>% 
  filter(i_desclu != "Residential") %>% # Filter out old Residential class
  drop_na() %>%   
  mutate(land_use = case_when(
    land_use == "low_veg_change_acres" ~ "Low Vegetation",
    land_use == "barren_change_acres" ~ "Barren",
    land_use == "water_change_acres" ~ "Water",
    land_use == "buildings_change_acres" ~ "Buildings",
    land_use == "road_change_acres" ~ "Roads",
    land_use == "shrub_change_acres" ~ "Shrub",
    land_use == "wetlands_change_acres" ~ "Wetland",
    land_use == "impervious_change_acres" ~ "Impervious",
    land_use == "tc_change_acres" ~ "Tree Canopy")) %>% 
  mutate(i_desclu = case_when(
    i_desclu == "Agricultural" ~ "Agricultural",
    i_desclu == "Apartments" ~ "Apartments",
    i_desclu == "Commercial" ~ "Commercial",
    i_desclu == "Commercial / Residential" ~ "Commercial / Residential",
    i_desclu == "Commercial Condominium" ~ "Commercial Condominium",
    i_desclu == "Country Club" ~ "Country Club",
    i_desclu == "Exempt" ~ "Exempt",
    i_desclu == "Exempt Commercial" ~ "Exempt Commercial",
    i_desclu == "Industrial" ~ "Industrial",
    i_desclu == "Marsh Land" ~ "Marsh Land",
    i_desclu == "Residential / Commercial" ~ "Residential / Commercial",
    i_desclu == "Residential Condominium" ~ "Residential Condominium",
    i_desclu == "Town House" ~ "Town House",
    i_desclu == "Residential_2" ~ "Residential"
  )) %>% 
    drop_na()

# String Wrap Function
land_use_acres_update$i_desclu = stwr(land_use_acres_update$i_desclu)

lu_update_plot <- ggplot(data = land_use_acres_update, aes(x = land_use, y = acres)) +
  geom_col(aes(fill = land_use)) +
  facet_wrap(~i_desclu, scales = "free_y") +
  labs(title = "Land Use Change",
       y = "Change in Area (Acres)") +
  theme_minimal() +
  geom_hline(aes(yintercept=0)) +
  scale_fill_manual(values = lu_tc_pallette) +
  theme(
    axis.title.x = element_blank(),
    axis.text.x = element_blank(),
    text = element_text(family = "Times", size = 14),
    axis.text = element_text(size = 14),
    axis.title = element_text(size = 14, face = "bold"),
    plot.title = element_text(size = 16, face = "bold"),
#    legend.position = "none",
    legend.position = "bottom",
    legend.title = element_text(size = 14, face = "bold"),
    legend.title.align = 0.5,
     strip.background = element_rect(color = "grey40", fill = "grey30"),
    strip.text = element_text(size = 12, color = "white", face = "bold"),
    panel.border = element_rect(color = "grey40", fill = NA)
   ) +
    guides(fill = guide_legend(title = "Land Use",
                               title.position = "top",
                               nrow = 2))
lu_update_plot

ggsave(here("Graphics", "5_land_use_change_tc.jpg"), lu_update_plot, width=9, height=7)

```

Land Use Forest/Tree Canopy Outside Forest
```{r}
#---------------------------------------
# Land Use Change in Acres In vs. Out of Forest
#---------------------------------------
land_use_tc <- land_use_update %>% 
  select(i_desclu, forest_change_acres:outside_forest_change_acres) %>% 
  pivot_longer(!i_desclu, names_to = "forest_type", values_to = "acres") %>% 
  mutate(forest_type = case_when(
    forest_type == "forest_change_acres" ~ "Forest",
    forest_type == "outside_forest_change_acres" ~ "Tree Canopy Outside Forest")) %>% 
    mutate(i_desclu = case_when(
    i_desclu == "Agricultural" ~ "Agricultural",
    i_desclu == "Apartments" ~ "Apartments",
    i_desclu == "Commercial" ~ "Commercial",
    i_desclu == "Commercial / Residential" ~ "Commercial / Residential",
    i_desclu == "Commercial Condominium" ~ "Commercial Condominium",
    i_desclu == "Country Club" ~ "Country Club",
    i_desclu == "Exempt" ~ "Exempt",
    i_desclu == "Exempt Commercial" ~ "Exempt Commercial",
    i_desclu == "Industrial" ~ "Industrial",
    i_desclu == "Marsh Land" ~ "Marsh Land",
    i_desclu == "Residential / Commercial" ~ "Residential / Commercial",
    i_desclu == "Residential Condominium" ~ "Residential Condominium",
    i_desclu == "Town House" ~ "Town House",
    i_desclu == "Residential_2" ~ "Residential"
  )) %>% 
  drop_na()

# String Wrap Function
land_use_tc$i_desclu = stwr(land_use_tc$i_desclu)

# Plot
#---------------------------------------
ggplot(data = land_use_tc, aes(x = i_desclu, y = acres)) +
  geom_col(position = "dodge",
           aes(fill = forest_type)) +
  labs(x = "Land Use Type",
    y = "Change in Acres") +
  scale_fill_manual(values = c("#24693d", # Inside
                               "#6eb663" # Outside
                               )) +
  coord_flip() +
  theme_minimal()
  # geom_hline(aes(yintercept=0))

# Facet
#---------------------------------------
lu_tc_plot <- ggplot(data = land_use_tc, aes(x = forest_type, y = acres)) +
  geom_col(position = "dodge",
           aes(fill = forest_type)) +
  labs(title = "Tree Canopy Change By Land Use Within and Outside Forests",
       y = "Change in Area (Acres)") +
  facet_wrap(~i_desclu, scales = "free_y") +
    scale_fill_manual(values = c("#24693d", # Inside
                               "#6eb663" # Outside
                               )) +
  theme_minimal() +
  geom_hline(aes(yintercept=0)) +
  theme(
    axis.title.x = element_blank(),
    axis.text.x = element_blank(),
    axis.title = element_text(size = 14, face = "bold"),
    plot.title = element_text(size = 16, face = "bold"),
    legend.title = element_text(size = 14, face = "bold"),
    legend.title.align = 0.5,
    legend.position = "bottom",
    strip.background = element_rect(color = "grey40", fill = "grey30"),
    strip.text = element_text(size = 12, color = "white", face = "bold"),
    panel.border = element_rect(color = "grey40", fill = NA)
  ) +
  guides(fill = guide_legend(title = "Forest Type",
                               title.position = "top"))
  
lu_tc_plot

ggsave(here("Graphics", "5_lu_forest_tc.jpg"), lu_tc_plot, width = 7.29, height = 6)

```

```{r}
#---------------------------------------
# County Change by Period
#---------------------------------------
county_change_by_period_v2 <- ggplot(data = county_change_period, aes(x = county, y = year_diff))+
  geom_col(aes(fill = county))+
  facet_wrap(~time_period) +
  scale_fill_manual(values = county_pallette) +
  labs(x = " ",
       y = "Total Change in Area (Acres)")+
  theme_minimal()+
  geom_hline(aes(yintercept=0))+
  geom_vline(aes(xintercept=0))+
  theme(
    axis.text.x = element_blank(),
    axis.title.y = element_text(size = 14, face = "bold"),
    strip.background = element_rect(color = "grey40", fill = "grey30"),
    strip.text = element_text(size = 14, color = "white", face = "bold"),
    panel.border = element_rect(color = "grey40", fill = NA),
#    legend.position = "none"
    legend.position = "bottom",
    legend.title = element_text(size = 14, face = "bold"),
    legend.title.align = 0.5,
  ) +
  guides(fill = guide_legend(title = "Jurisdiction",
                             title.position = "top",
                             nrow = 4))
# )
county_change_by_period_v2

ggsave(here("Graphics", "county_change_by_period_v2.jpg"), county_change_by_period_v2)

# County Change by Period With Lables for Jarlath
# county_change_demo <- ggplot(data = county_change_period, aes(x = county, y = year_diff))+
#   geom_col(aes(fill = county))+
#   geom_text(aes(label = county, color = county), check_overlap = TRUE, angle = 45, size = 3.5) +
#   facet_wrap(~time_period) +
#   scale_fill_manual(values = county_pallette) +
#   scale_color_manual(values = county_pallette) +
#   labs(x = " ",
#        y = "Total Change in Acreage")+
#   theme_minimal()+
#   geom_hline(aes(yintercept=0))+
#   geom_vline(aes(xintercept=0))+
#   theme(
#     axis.text.x = element_blank(),
#     axis.title.y = element_text(size = 14, face = "bold"),
#     strip.background = element_rect(color = "grey40", fill = "grey30"),
#     strip.text = element_text(size = 14, color = "white", face = "bold"),
#     panel.border = element_rect(color = "grey40", fill = NA),
#     legend.position = "none"
#   )

# ggsave(here("Graphics", "county_change_labled.jpg"), county_change_demo)

```
### PFA

Acres Land Cover
```{r}
#---------------------------------------
# Priority Funding Area land use change by county
#---------------------------------------
pfa_acres <- pfa_data %>% 
  select(jurscode, tc_change_acres:impervious_change_acres) %>% 
  pivot_longer(!jurscode, names_to = "type", values_to = "acres") %>% 
  drop_na() %>% 
  mutate(type = case_when(
    type == "low_veg_change_acres" ~ "Low Vegetation",
    type == "barren_change_acres" ~ "Barren",
    type == "water_change_acres" ~ "Water",
    type == "buildings_change_acres" ~ "Buildings",
    type == "road_change_acres" ~ "Roads",
    type == "shrub_change_acres" ~ "Shrub",
    type == "wetlands_change_acres" ~ "Wetland",
    type == "impervious_change_acres" ~ "Impervious",
    type == "forest_change_acres" ~ "Forest",
    type == "tc_change_acres" ~ "Tree Canopy")) %>% 
  mutate(jurscode = case_when(
    jurscode == "PRIN" ~ "Prince George's",
    jurscode == "SOME" ~ "Somerset",
    jurscode == "KENT" ~ "Kent",
    jurscode == "CARO" ~ "Caroline",
    jurscode == "HARF" ~ "Harford",
    jurscode == "WORC" ~ "Worcester",
    jurscode == "CALV" ~ "Calvert",
    jurscode == "BACI" ~ "Baltimore City",
    jurscode == "GARR" ~ "Garrett",
    jurscode == "CHAR" ~ "Charles",
    jurscode == "STMA" ~ "St. Mary's",
    jurscode == "ANNE" ~ "Anne Arundel",
    jurscode == "CARR" ~ "Carroll",
    jurscode == "TALB" ~ "Talbot",
    jurscode == "QUEE" ~ "Queen Anne's",
    jurscode == "FRED" ~ "Frederick",
    jurscode == "CECI" ~ "Cecil",
    jurscode == "WICO" ~ "Wicomico",
    jurscode == "DORC" ~ "Dorchester",
    jurscode == "ALLE" ~ "Allegany",
    jurscode == "MONT" ~ "Montgomery",
    jurscode == "WASH" ~ "Washington",
    jurscode == "HOWA" ~ "Howard",
    jurscode == "BACO" ~ "Baltimore")) %>% 
  group_by(jurscode, type) %>% 
  summarize(acres_change = sum(acres))

# Plot
#---------------------------------------
pfa_acres_plot <- ggplot(data = pfa_acres, aes(x = type, y = acres_change)) +
  geom_col(aes(fill = type)) +
  labs(title = "Priority Funding Area Change",
    y = "Area Change (Acres)") +
  facet_wrap(~jurscode, ncol = 4, scales = "free_y")+
  scale_fill_manual(values = lu_tc_pallette) +
  theme_minimal() +
  geom_hline(aes(yintercept=0)) +
    theme(
  plot.title = element_text(size = 16, face = "bold"),
  legend.position = "bottom",
  legend.title.align = 0.5,
  legend.title = element_text(size = 14, face = "bold"),
   axis.text.x = element_blank(),
   axis.title.x = element_blank(),
   axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0), size = 14, face = "bold"),
strip.background = element_rect(color = "grey40", fill = "grey30"),
strip.text = element_text(size = 10, color = "white", face = "bold"),
panel.border = element_rect(color = "grey40", fill = NA),
  ) +
  guides(fill = guide_legend(title = "Land Cover Type",
                             title.position = "top"))

pfa_acres_plot

ggsave(here("Graphics", "5_pfa_acres.jpg"), pfa_acres_plot)

```
Acres Inside/Outside
```{r}
#---------------------------------------
# Priority Funding Area Tree Canopy Inside/Outside Forest Change
#---------------------------------------
pfa_in_out <- pfa_data %>% 
  select(jurscode, forest_change_acres:non_forest_change_acres) %>% 
  pivot_longer(!jurscode, names_to = "forest_type", values_to = "acres") %>% 
  drop_na() %>% 
    mutate(forest_type = case_when(
    forest_type == "forest_change_acres" ~ "Forest",
    forest_type == "non_forest_change_acres" ~ "Tree Canopy Outside Forest")) %>% 
  mutate(jurscode = case_when(
    jurscode == "PRIN" ~ "Prince George's",
    jurscode == "SOME" ~ "Somerset",
    jurscode == "KENT" ~ "Kent",
    jurscode == "CARO" ~ "Caroline",
    jurscode == "HARF" ~ "Harford",
    jurscode == "WORC" ~ "Worcester",
    jurscode == "CALV" ~ "Calvert",
    jurscode == "BACI" ~ "Baltimore City",
    jurscode == "GARR" ~ "Garrett",
    jurscode == "CHAR" ~ "Charles",
    jurscode == "STMA" ~ "St. Mary's",
    jurscode == "ANNE" ~ "Anne Arundel",
    jurscode == "CARR" ~ "Carroll",
    jurscode == "TALB" ~ "Talbot",
    jurscode == "QUEE" ~ "Queen Anne's",
    jurscode == "FRED" ~ "Frederick",
    jurscode == "CECI" ~ "Cecil",
    jurscode == "WICO" ~ "Wicomico",
    jurscode == "DORC" ~ "Dorchester",
    jurscode == "ALLE" ~ "Allegany",
    jurscode == "MONT" ~ "Montgomery",
    jurscode == "WASH" ~ "Washington",
    jurscode == "HOWA" ~ "Howard",
    jurscode == "BACO" ~ "Baltimore")) %>% 
  group_by(jurscode, forest_type) %>% 
  summarize(acres_change = sum(acres))

# Plot
#---------------------------------------
pfa_in_out_plot <- ggplot(data = pfa_in_out, aes(x = forest_type, y = acres_change)) +
  geom_col(aes(fill = forest_type)) +
  labs(title = "Priority Funding Area Change",
    y = "Area Change (Acres)") +
  facet_wrap(~jurscode, ncol = 4, scales = "free_y")+
  scale_fill_manual(values = c("#24693d", # Inside
                              "#6eb663" # Outside
                    )) +
  theme_minimal() +
  geom_hline(aes(yintercept=0)) +
    theme(
  plot.title = element_text(size = 16, face = "bold"),
  legend.position = "bottom",
  legend.title.align = 0.5,
  legend.title = element_text(size = 14, face = "bold"),
   axis.text.x = element_blank(),
   axis.title.x = element_blank(),
   axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0), size = 14, face = "bold"),
strip.background = element_rect(color = "grey40", fill = "grey30"),
strip.text = element_text(size = 10, color = "white", face = "bold"),
panel.border = element_rect(color = "grey40", fill = NA),
  ) +
  guides(fill = guide_legend(title = "Forest Type",
                             title.position = "top"))

pfa_in_out_plot

ggsave(here("Graphics", "5_pfa_acres_tc.jpg"), pfa_in_out_plot, height = 7)
```


Percent
```{r}
#---------------------------------------
# Priority Funding Area percent change by county and land use
#---------------------------------------
pfa_percent <- pfa_data %>% 
  select(jurscode, tc_percent_change:imperv_percent_change) %>% 
  pivot_longer(!jurscode, names_to = "type", values_to = "percent") %>% 
  drop_na() %>% 
  group_by(jurscode, type) %>% 
  summarize(percent_change = sum(percent)) %>% 
  mutate(type = case_when(
    type == "low_veg_percent_change" ~ "Low Vegetation",
    type == "barren_percent_change" ~ "Barren",
    type == "water_percent_change" ~ "Water",
    type == "building_percent_change" ~ "Buildings",
    type == "road_percent_change" ~ "Roads",
    type == "shrub_percent_change" ~ "Shrub",
    type == "wetlands_percent_change" ~ "Wetland",
    type == "imperv_percent_change" ~ "Impervious",
    type == "tc_percent_change" ~ "Tree Canopy")) %>% 
  mutate(jurscode = case_when(
    jurscode == "PRIN" ~ "Prince George's",
    jurscode == "SOME" ~ "Somerset",
    jurscode == "KENT" ~ "Kent",
    jurscode == "CARO" ~ "Caroline",
    jurscode == "HARF" ~ "Harford",
    jurscode == "WORC" ~ "Worcester",
    jurscode == "CALV" ~ "Calvert",
    jurscode == "BACI" ~ "Baltimore City",
    jurscode == "GARR" ~ "Garrett",
    jurscode == "CHAR" ~ "Charles",
    jurscode == "STMA" ~ "St. Mary's",
    jurscode == "ANNE" ~ "Anne Arundel",
    jurscode == "CARR" ~ "Carroll",
    jurscode == "TALB" ~ "Talbot",
    jurscode == "QUEE" ~ "Queen Anne's",
    jurscode == "FRED" ~ "Frederick",
    jurscode == "CECI" ~ "Cecil",
    jurscode == "WICO" ~ "Wicomico",
    jurscode == "DORC" ~ "Dorchester",
    jurscode == "ALLE" ~ "Allegany",
    jurscode == "MONT" ~ "Montgomery",
    jurscode == "WASH" ~ "Washington",
    jurscode == "HOWA" ~ "Howard",
    jurscode == "BACO" ~ "Baltimore")) 

# Plot
#---------------------------------------
pfa_percent_plot <- ggplot(data = pfa_percent, aes(x = type, y = percent_change)) +
  geom_col(aes(fill = type)) +
  labs(y = "Percent Change") +
  facet_wrap(~jurscode, ncol = 4, scales = "free_y")+
  scale_fill_manual(values = lu_tc_pallette) +
  theme_minimal() +
  geom_hline(aes(yintercept=0)) +
    theme(
  plot.title = element_text(size = 16, face = "bold"),
  legend.position = "bottom",
  legend.title.align = 0.5,
  legend.title = element_text(size = 14, face = "bold"),
   axis.text.x = element_blank(),
   axis.title.x = element_blank(),
   axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0), size = 14, face = "bold"),
strip.background = element_rect(color = "grey40", fill = "grey30"),
strip.text = element_text(size = 10, color = "white", face = "bold"),
panel.border = element_rect(color = "grey40", fill = NA),
  ) +
  guides(fill = guide_legend(title = "Land Cover Type",
                             title.position = "top"))

pfa_percent_plot

ggsave(here("Graphics", "5_pfa_percent.jpg"), pfa_percent_plot, height = 7)



```

### Counties Individually (Just in case)
Allegany County
```{r}

# Allegany
#---------------------------------------
allegany <- county_change %>% 
  filter(county == "Allegany")

allegany_total <- ggplot(data = allegany, aes(x = year, y = acres)) +
  geom_line(color = "seagreen4", size = 2) +
      labs(x = "Year",
       y = "Forested Area (acres)",
       title = "Allegany County") +
  theme_minimal()

allegany_total

allegany_change <- ggplot(data = allegany, aes(x = year, y = year_diff))+
  geom_col(fill = "seagreen4")+
  scale_x_continuous(breaks = c(2005, 2010, 2015, 2020),
    labels = c("2000-2005","2005-2010","2010-2015","2015-2020"))+
    labs(x = "Time Period",
       y = "Change in Total Acreage",
       title = "Allegany County") +
  geom_hline(aes(yintercept=0))+
    geom_vline(aes(xintercept=2002))+
  theme_minimal()

allegany_change

```
Anne Arundel County
```{r}
# Anne Arundel
#---------------------------------------
anne_arundel <- county_change %>% 
  filter(county == "Anne Arundel")

anne_arundel_total <- ggplot(data = anne_arundel, aes(x = year, y = acres)) +
  geom_line(color = "seagreen4", size = 2) +
      labs(x = "Year",
       y = "Forested Area (acres)",
       title = "Anne Arundel County") +
  theme_minimal()

anne_arundel_total

anne_arundel_change <- ggplot(data = anne_arundel, aes(x = year, y = year_diff))+
  geom_col(fill = "seagreen4")+
  scale_x_continuous(breaks = c(2005, 2010, 2015, 2020),
    labels = c("2000-2005","2005-2010","2010-2015","2015-2020"))+
    labs(x = "Time Period",
       y = "Change in Total Acreage",
       title = "Anne Arundel County") +
  geom_hline(aes(yintercept=0))+
    geom_vline(aes(xintercept=2002))+
  theme_minimal()

anne_arundel_change

```
Baltimore County
```{r}
# Baltimore
#---------------------------------------
baltimore <- county_change %>% 
  filter(county == "Baltimore")

baltimore_total <- ggplot(data = baltimore, aes(x = year, y = acres)) +
  geom_line(color = "seagreen4", size = 2) +
      labs(x = "Year",
       y = "Forested Area (acres)",
       title = "Baltimore County") +
  theme_minimal()

baltimore_total

baltimore_change <- ggplot(data = baltimore, aes(x = year, y = year_diff))+
  geom_col(fill = "seagreen4")+
  scale_x_continuous(breaks = c(2005, 2010, 2015, 2020),
    labels = c("2000-2005","2005-2010","2010-2015","2015-2020"))+
    labs(x = "Time Period",
       y = "Change in Total Acreage",
       title = "Baltimore County") +
  geom_hline(aes(yintercept=0))+
    geom_vline(aes(xintercept=2002))+
  theme_minimal()

baltimore_change

```
Baltimore City County
```{r}
# Baltimore City
#---------------------------------------
baltimore_city <- county_change %>% 
  filter(county == "Baltimore City")

baltimore_city_total <- ggplot(data = baltimore_city, aes(x = year, y = acres)) +
  geom_line(color = "seagreen4", size = 2) +
      labs(x = "Year",
       y = "Forested Area (acres)",
       title = "Baltimore City County") +
  theme_minimal()

baltimore_city_total

baltimore_city_change <- ggplot(data = baltimore_city, aes(x = year, y = year_diff))+
  geom_col(fill = "seagreen4")+
  scale_x_continuous(breaks = c(2005, 2010, 2015, 2020),
    labels = c("2000-2005","2005-2010","2010-2015","2015-2020"))+
    labs(x = "Time Period",
       y = "Change in Total Acreage",
       title = "Baltimore City County") +
  geom_hline(aes(yintercept=0))+
    geom_vline(aes(xintercept=2002))+
  theme_minimal()

baltimore_city_change

```
Calvert County
```{r}
# Calvert
#---------------------------------------
calvert <- county_change %>% 
  filter(county == "Calvert")

calvert_total <- ggplot(data = calvert, aes(x = year, y = acres)) +
  geom_line(color = "seagreen4", size = 2) +
      labs(x = "Year",
       y = "Forested Area (acres)",
       title = "Calvert County") +
  theme_minimal()

calvert_total

calvert_change <- ggplot(data = calvert, aes(x = year, y = year_diff))+
  geom_col(fill = "seagreen4")+
  scale_x_continuous(breaks = c(2005, 2010, 2015, 2020),
    labels = c("2000-2005","2005-2010","2010-2015","2015-2020"))+
    labs(x = "Time Period",
       y = "Change in Total Acreage",
       title = "Calvert County") +
  geom_hline(aes(yintercept=0))+
    geom_vline(aes(xintercept=2002))+
  theme_minimal()

calvert_change

```
Caroline County
```{r}
# Caroline
#---------------------------------------
caroline <- county_change %>% 
  filter(county == "Caroline")

caroline_total <- ggplot(data = caroline, aes(x = year, y = acres)) +
  geom_line(color = "seagreen4", size = 2) +
      labs(x = "Year",
       y = "Forested Area (acres)",
       title = "Caroline County") +
  theme_minimal()

caroline_total

caroline_change <- ggplot(data = calvert, aes(x = year, y = year_diff))+
  geom_col(fill = "seagreen4")+
  scale_x_continuous(breaks = c(2005, 2010, 2015, 2020),
    labels = c("2000-2005","2005-2010","2010-2015","2015-2020"))+
    labs(x = "Time Period",
       y = "Change in Total Acreage",
       title = "Caroline County") +
  geom_hline(aes(yintercept=0))+
    geom_vline(aes(xintercept=2002))+
  theme_minimal()

caroline_change

```
Carroll County
```{r}
# Carroll
#---------------------------------------
carroll <- county_change %>% 
  filter(county == "Carroll")

carroll_total <- ggplot(data = carroll, aes(x = year, y = acres)) +
  geom_line(color = "seagreen4", size = 2) +
      labs(x = "Year",
       y = "Forested Area (acres)",
       title = "Carroll County") +
  theme_minimal()

carroll_total

carroll_change <- ggplot(data = carroll, aes(x = year, y = year_diff))+
  geom_col(fill = "seagreen4")+
  scale_x_continuous(breaks = c(2005, 2010, 2015, 2020),
    labels = c("2000-2005","2005-2010","2010-2015","2015-2020"))+
    labs(x = "Time Period",
       y = "Change in Total Acreage",
       title = "Carroll County") +
  geom_hline(aes(yintercept=0))+
    geom_vline(aes(xintercept=2002))+
  theme_minimal()

carroll_change

```